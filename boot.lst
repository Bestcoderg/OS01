     1                                  ORG  0x7c00
     2                                  
     3 00000000 EB4E                    jmp  entry
     4 00000002 90                      db   0x90
     5 00000003 4F534B45524E454C        DB   "OSKERNEL"
     6 0000000B 0002                    DW   512
     7 0000000D 01                      DB   1
     8 0000000E 0100                    DW   1
     9 00000010 02                      DB   2
    10 00000011 E000                    DW   224
    11 00000013 400B                    DW   2880
    12 00000015 F0                      DB   0xf0
    13 00000016 0900                    DW   9
    14 00000018 1200                    DW   18
    15 0000001A 0200                    DW   2
    16 0000001C 00000000                DD   0
    17 00000020 400B0000                DD   2880
    18 00000024 000029                  DB   0,0,0x29
    19 00000027 FFFFFFFF                DD   0xFFFFFFFF
    20 0000002B 4D5946495253544F53-     DB   "MYFIRSTOS  "
    20 00000034 2020               
    21 00000036 4641543132202020        DB   "FAT12   "
    22 0000003E 00<rept>                times  18  DB 0
    23                                  
    24                                  entry:
    25 00000050 B80000                      mov  ax, 0
    26 00000053 8ED0                        mov  ss, ax
    27 00000055 BC007C                      mov  sp, 0x7c00
    28 00000058 8ED8                        mov  ds, ax
    29                                  
    30                                  readfloppy:
    31 0000005A B82008                      mov  ax, 0x0820   ;将数据读到内存0x0820之后，以免覆盖当前内容
    32 0000005D 8EC0                        mov  es, ax
    33 0000005F B500                        mov  ch, 0        ;CH 用来存储柱面号
    34 00000061 B600                        mov  dh, 0        ;DH 用来存储磁头号
    35 00000063 B102                        mov  cl, 2        ;CL 用来存储扇区号
    36                                  
    37                                  readloop:
    38 00000065 BE0000                      mov  si, 0
    39                                  
    40                                  retry:
    41 00000068 B402                        mov  ah, 0x02      ; AH = 02 表示要做的是读盘操作
    42 0000006A B001                        mov  al, 1         ; AL 表示要连续读取几个扇区
    43 0000006C BB0000                      mov  bx, 0
    44 0000006F B200                        mov  dl, 0x00      ;驱动器编号，A盘
    45 00000071 CD13                        int  0x13          ;调用BIOS中断实现磁盘读取功能
    46 00000073 7310                        jnc  next
    47 00000075 83C601                      add  si, 1
    48 00000078 83FE05                      cmp  si, 5         ;重试5次
    49 0000007B 7323                        jae  error
    50 0000007D B400                        mov  ah, 0x00
    51 0000007F B200                        mov  dl, 0x00
    52 00000081 CD13                        int  0x13          ;重置驱动器
    53 00000083 EBE3                        jmp  retry
    54                                  
    55                                  next:
    56 00000085 8CC0                        mov  ax, es
    57 00000087 050002                      add  ax, 0x0200
    58 0000008A 8EC0                        mov  es, ax        ;地址后移512byte
    59 0000008C 80C101                      add  cl, 1
    60 0000008F 80F912                      cmp  cl ,18
    61                                  
    62 00000092 E9(00C2)                    jmp  0xc200
    63                                      
    64                                  vmode:                 ;切换到VGA显示
    65 00000095 B013                        mov  al, 0x13      ;320x200x8位色彩
    66 00000097 B400                        mov  ah, 0x00
    67 00000099 CD10                    	int  0x10
    68 0000009B BE[C500]                    mov  si, vmsg
    69 0000009E EB03                        jmp  putloop
    70                                  
    71                                  
    72                                  error:
    73 000000A0 BE[B800]                    mov  si, msg
    74                                  
    75                                  putloop:               ;显示消息
    76 000000A3 8A04                        mov  al, [si]
    77 000000A5 83C601                      add  si, 1
    78 000000A8 3C00                        cmp  al, 0
    79 000000AA 7409                        je   fin
    80 000000AC B40E                        mov  ah, 0x0e
    81 000000AE BB0F00                      mov  bx, 15
    82 000000B1 CD10                        int  0x10
    83 000000B3 EBEE                        jmp  putloop
    84                                  
    85                                  fin:
    86 000000B5 F4                          hlt
    87 000000B6 EBFD                        jmp  fin
    88                                  
    89                                  msg:
    90 000000B8 0A0A                        DB  0x0a, 0x0a
    91 000000BA 6C6F6164206572726F-         DB "load error"
    91 000000C3 72                 
    92 000000C4 0A                          DB  0x0a
    93                                  
    94                                  vmsg:
    95 000000C5 0A0A                        DB  0x0a, 0x0a
    96 000000C7 475641206D6F6465            DB "GVA mode"
    97 000000CF 0A                          DB  0x0a
    98                                  
    99                                      ;填充空间，使得扇区末尾为aa55，方能被识别为MBR引导
   100 000000D0 00<rept>                    times	510-($-$$) db 0
   101 000001FE 55AA                    	DW	0xaa55
